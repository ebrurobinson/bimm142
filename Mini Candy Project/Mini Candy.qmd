---
title: "Mini Candy Project"
author: "Ebru Robinson"
format: html
toc: true

---


```{r}
#| label: setup-extra
#| include: false
library(skimr)
library(knitr)
```


```{r}
read.csv("candy-data.csv")
```
```{r}
candy_file <- "candy-data.csv"
```

```{r}
candy = read.csv(candy_file, row.names = 1)
head(candy)
```
```{r}
library(flextable)
flextable::flextable(head(candy))
```

```{r,message=FALSE}
library(dplyr)
candy |>nrow()
```
```{r}
win <- candy$winpercent
win.mean <- mean(win)
round(win.mean)
```

>Q1. How many different candy types are in this dataset?


```{r}
nrow(candy)
```
>Q2. How many fruity candy types are in the dataset?

```{r}
sum(candy$fruity == 1)
```
>Q3. What is your favorite candy in the dataset and what is it’s winpercent value?

My favorite candy is Snickers.I can find its popularity as follows:

```{r}
candy["Snickers", ]$winpercent
```
>Q4. What is the winpercent value for “Kit Kat”?

```{r}
candy["Kit Kat", ]$winpercent
```
>Q5. What is the winpercent value for “Tootsie Roll Snack Bars”?

```{r}
candy["Tootsie Roll Snack Bars", ]$winpercent
```

```{r}
library("skimr")
skim(candy) |> as.data.frame() |> kable()
skim(candy)
```
>Q6. Is there any variable/column that looks to be on a different scale to the majority of the other columns in the dataset?

Yes. The variable winpercent is on a different scale than most others, because it ranges from about 22 to 84, whereas most variables are either 0 or 1. The variables sugarpercent and pricepercent are also continuous but remain within 0–1, so winpercent stands out the most.

>Q7. What do you think a zero and one represent for the candy$chocolate column?

A zero indicates that the candy does not contain chocolate, and a one indicates that it does contain chocolate.


>Q8. Plot a histogram of winpercent values

```{r}
library(ggplot2)

ggplot(candy)+ aes(winpercent)+geom_histogram(bins=20)
```

>Q9. Is the distribution of winpercent values symmetrical?

```{r}
ggplot(candy)+ aes(winpercent)+geom_density()
```

>Q10. Is the center of the distribution above or below 50%?

Above

```{r}
mean(candy$winpercent)
```

>Q11. On average is chocolate candy higher or lower ranked than fruit candy?

```{r}
# 1. Find all chocolate candies
choc.inds <- as.logical(candy$chocolate)
choc.candy <- candy[choc.inds, ]

# 2. Extract the winpercent values
choc.win <- choc.candy$winpercent

# 3. Find the mean winpercent for chocolate candies
choc.mean <- mean(choc.win)

# 4. Do the same for fruity candies
fruit.inds <- as.logical(candy$fruity)
fruit.candy <- candy[fruit.inds, ]

# 5. Extract winpercent values for fruity candies
fruit.win <- fruit.candy$winpercent

# 6. Find the mean winpercent for fruity candies
fruit.mean <- mean(fruit.win)

# 7. Compare the two means
choc.mean
fruit.mean

```


>Q12. Is this difference statistically significant?

There is strong statistical evidence (p < 0.001) that chocolate candies are, on average, significantly more popular than fruity candies.

```{r}
t.test(choc.win,fruit.win)
```

>Q13. What are the five least liked candy types in this set?

```{r}
head(candy[order(candy$winpercent), ], n = 5)
```


>Q14. What are the top 5 all time favorite candy types out of this set?

```{r}
head(candy[order(-candy$winpercent), ], n = 5)
```

>Q15. Make a first barplot of candy ranking based on winpercent values.

```{r}
library(ggplot2)

ggplot(candy) + 
  aes(winpercent, rownames(candy)) +
  geom_col()
```

>Q16. This is quite ugly, use the reorder() function to get the bars sorted by winpercent?

```{r}
library(ggplot2)

ggplot(candy) +
  aes(x = winpercent, y = reorder(rownames(candy), winpercent)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Candy Rankings by Winpercent",
    x = "Winpercent (%)",
    y = "Candy"
  ) +
  theme_minimal()
```

```{r}
my_cols=rep("black", nrow(candy))
my_cols[as.logical(candy$chocolate)] = "chocolate"
my_cols[as.logical(candy$bar)] = "brown"
my_cols[as.logical(candy$fruity)] = "pink"

ggplot(candy) + 
  aes(winpercent, reorder(rownames(candy),winpercent)) +
  geom_col(fill=my_cols) 
```

## Winpercent vs Pricepercent

```{r}

ggplot(candy) +
  aes(winpercent, pricepercent, label=rownames(candy)) +
  geom_point(col=my_cols) + 
  geom_text(col=my_cols, size=3.3, max.overlaps = 5)

```

##corrplot

```{r}
cij <- cor(candy)
```

```{r}
library(corrplot)
corrplot(cij)
```

##PCA

The main function of this on R is `prcomp()` and we want to set `scale=TRUE` here:

```{r}
pca <- prcomp(candy, scale=TRUE)
summary(pca)
```

Let's loom at the first main result figure- the "pc-plot" or PC1 vc PC2

```{r}
library(ggrepel)
# Find points to label
label_points <- as.data.frame(pca$x) %>%
  slice_max(PC1, n = 5) %>%
  bind_rows(slice_min(as.data.frame(pca$x), PC1, n = 5))

ggplot(as.data.frame(pca$x), aes(PC1, PC2)) +
  geom_point(col = my_cols) +
  geom_text_repel(
    data = label_points,
    aes(label = rownames(label_points)),
    col = "black"
  ) +
  theme_minimal()

```
Don't forget about your variable "loadings" - how the original variables contribute  to your new PC's

```{r}
my_data <- cbind(candy, pca$x[,1:3])
p <- ggplot(my_data) + 
        aes(x=PC1, y=PC2, 
            size=winpercent/100,  
            text=rownames(my_data),
            label=rownames(my_data)) +
        geom_point(col=my_cols)
```

```{r pca-plot, warning=FALSE}
p + 
  geom_text_repel(size = 3.3, col = my_cols, max.overlaps = 7) +
  theme(legend.position = "none") +
  labs(
    title = "Halloween Candy PCA Space",
    subtitle = "Colored by type: chocolate bar (dark brown), chocolate other (light brown), fruity (red), other (black)",
    caption = "Data from 538"
  )

```


```{r}

library(plotly)
plotly::ggplotly(p)
```


